sudo: required
env:
  - dockerTag=pg2k4j
services:
  - docker
language: java

cache:
  directories:
    - ~/.m2/repository

before_install:
  ## export GPG details
  - echo $GPG_SECRET_KEYS | base64 --decode | gpg --import

script:
  - mvn --settings .maven.xml clean install jacoco:report -Dgpg.skip -Dmaven.javadoc.skip=true -B -V
  - bash <(curl -s https://codecov.io/bash)

before_deploy:
  - mvn versions:set -DnewVersion=${TRAVIS_TAG}
  - git commit -am "Bump Version to ${TRAVIS_TAG}"
  - mvn clean deploy --settings .maven.xml -DskipTests=true -U -P release

deploy:
  provider: releases
  api_key:
    secure: bSQp9H5KsclG8SdKh+c7tRB6kteVed0lI1Hq+pUYEEKazhrZG5DB2+2Wp6EW7U3PbX2OayNMWcVN+lSBPtRbjKZ3M3oOGENcln3WC7gPOOj8ZU4fmO9I8hRtjHYSPntZFQH5EYted1YSccG1wLSZAsFmi556SjSPnn06vTq7SjZyJLp7Sjj7LK0UPZkWqzs1YsM49F1l+gk20L5x6aNRkuqdDmTEDvQB6DqnCU++IX6N6BuDjSpMV/PXw6J1tQpgxSniae3kpOmruR+ZFK+iZB84v94Q88FmOEicT3CuJbkPAzayH+7VEuxJiBNnNMWjPY/BKnmi9o/SbwDwyJZiS4gC1F4z9CzzaMaEiQxhUiMcUtiJMYUb90t3BFw0eYRLwRrUuSo3EPIPwRHeYT3/Toic5gUZPXpgAviEo2oe80GN56ecUgiO+3hXoT4mUuEDx8bsTclJpxI/58Cv6QwwfrWyx8/9Hjrj+uZnRG+oXk20R4q5ek38Y5SoLgD6zLy4FmQWkCW4MF6TVAci7aJLQk9/0EdfXkJ325k3/anT6WtHuzPNhbFQG4Ci7MVVzs9srzaV6hqNKFJw7n0WU31Z2AYx6oHfq/XnhaWUDcoOhUblwWitedOWSgtAmkWfle2DNfKMKJrFFxXIVE83cOmLTyTbhGcVxTb9tYbHFMOY77w=
  file:
    - target/pg2k4j-${TRAVIS_TAG}.jar
  skip_cleanup: true
  on:
    repo: disneystreaming/pg2k4j
    tags: true
    branch: publish-to-maven
    condition: $TRAVIS_BRANCH =~ ^([0-9]+.[0-9]+.[0-9]+)-?(.*)?$

